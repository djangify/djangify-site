<section class="py-16 bg-[color:var(--color-brand-light)]"
         x-data="galleryLightbox()">

  <div class="max-w-7xl mx-auto px-6">
    <h2 class="text-3xl font-bold mb-8 text-center">Gallery</h2>

    <!-- Image Grid -->
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {% for img in gallery_items %}
      <div class="border rounded-lg overflow-hidden hover:shadow-lg transition cursor-pointer"
           @click="open({{ forloop.counter0 }})">

        <img src="{{ img.image.url }}"
             alt="{{ img.title }}"
             class="w-full h-48 object-cover">

        {% if img.title or img.caption %}
        <div class="p-4 space-y-2">
          {% if img.title %}
            <h3 class="text-lg font-semibold">{{ img.title }}</h3>
          {% endif %}
          {% if img.caption %}
            <p class="text-sm text-gray-600">{{ img.caption }}</p>
          {% endif %}
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- LIGHTBOX MODAL -->
  <template x-if="isOpen">
    <div class="fixed inset-0 bg-slate-900/85 flex items-center justify-center z-50 p-6"
         @click.self="close">

      <div class="relative max-w-4xl w-full">

        <!-- Close Button -->
        <button @click="close"
            class="absolute top-2 right-2 text-white drop-shadow-[0_2px_6px_rgba(0,0,0,0.8)] text-3xl font-bold">
          &times;
        </button>


        <!-- Image -->
        <img :src="currentImage.src"
             :alt="currentImage.caption"
             class="w-full max-h-[80vh] object-contain rounded-lg">

        <!-- Caption -->
        <p class="text-center text-white mt-4" x-text="currentImage.caption"></p>

        <!-- Navigation -->
        <div class="absolute inset-0 flex justify-between items-center px-4">
          <button @click="prev"
        class="text-white drop-shadow-[0_2px_6px_rgba(0,0,0,0.8)] text-4xl font-bold select-none">
            ‹
        </button>

        <button @click="next"
                class="text-white drop-shadow-[0_2px_6px_rgba(0,0,0,0.8)] text-4xl font-bold select-none">
            ›
        </button>

        </div>

      </div>
    </div>
  </template>
</section>

<script>
function galleryLightbox() {
    return {
        isOpen: false,
        currentIndex: 0,
        items: [],

        open(index) {
            this.currentIndex = index;
            this.isOpen = true;

            // Add ESC listener when opening
            document.addEventListener('keydown', this.handleKey);
        },

        close() {
            this.isOpen = false;

            // Remove ESC listener
            document.removeEventListener('keydown', this.handleKey);
        },

        handleKey(event) {
            if (event.key === 'Escape') {
                this.isOpen = false;
            }
            if (event.key === 'ArrowRight') {
                this.next();
            }
            if (event.key === 'ArrowLeft') {
                this.prev();
            }
        },

        next() {
            this.currentIndex = (this.currentIndex + 1) % this.items.length;
        },

        prev() {
            this.currentIndex =
                (this.currentIndex - 1 + this.items.length) % this.items.length;
        },
    };
}

</script>
